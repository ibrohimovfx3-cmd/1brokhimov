<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake — Frontend o'yin</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:linear-gradient(180deg,#071024 0%, #081228 100%);color:#e6eef6}
    .wrap{min-height:100%;display:grid;place-items:center;padding:24px}
    .card{width:980px;max-width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,0.7);display:grid;grid-template-columns:1fr 320px;gap:18px}
    .left{display:flex;flex-direction:column;gap:12px}
    .canvas-wrap{background:var(--card);border-radius:8px;padding:10px;display:flex;align-items:center;justify-content:center}
    canvas{background:#071428;border-radius:6px;display:block}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent),#7c3aed);border:none;color:#021025}
    .panel{padding:12px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0));}
    h1{margin:0;font-size:20px}
    p{margin:6px 0;color:var(--muted);font-size:13px}
    .stat{display:flex;gap:10px;align-items:center}
    .big{font-weight:700;font-size:28px}
    .kbd{display:inline-block;padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.02);font-family:monospace}
    .touch-controls{display:none;gap:6px;margin-top:8px}
    .touch-controls button{padding:14px;border-radius:10px}
    @media (max-width:860px){.card{grid-template-columns:1fr;}.touch-controls{display:flex}}
    footer{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Snake o'yin">
      <div class="left">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h1>Snake — Frontend o'yin</h1>
            <p>Klaviatura yoki touch bilan o'ynang. Maqsad — ilonni oziq-ovqatni yutib, balni oshirish.</p>
          </div>
          <div class="stat panel" style="text-align:right">
            <div style="font-size:12px;color:var(--muted)">Score</div>
            <div id="score" class="big">0</div>
          </div>
        </div>

        <div class="canvas-wrap" style="margin-top:8px">
          <canvas id="game" width="640" height="400" aria-label="snake game canvas"></canvas>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div class="controls">
            <button id="startBtn" class="primary">Start</button>
            <button id="pauseBtn">Pause</button>
            <button id="resetBtn">Reset</button>
            <button id="speedBtn">Speed: Normal</button>
          </div>
          <div style="text-align:right">
            <div style="font-size:12px;color:var(--muted)">High score</div>
            <div id="high" class="big">0</div>
          </div>
        </div>

        <div class="touch-controls">
          <button id="upBtn">▲</button>
          <div style="display:flex;gap:6px">
            <button id="leftBtn">◀</button>
            <button id="downBtn">▼</button>
            <button id="rightBtn">▶</button>
          </div>
        </div>

        <footer>Controls: Arrow keys / WASD. Touch controls visible on small screens.</footer>
      </div>

      <aside class="panel" style="display:flex;flex-direction:column;gap:10px">
        <div>
          <h2 style="font-size:16px;margin:0">Qoidalar</h2>
          <p>O'zingizni o'sib boring, devorga yoki o'zingizga tegmang. Har bir ozuqa +1 ball beradi.</p>
        </div>
        <div>
          <h3 style="margin:0;font-size:14px">Sozlamalar</h3>
          <p>O'ynash tezligini o'zgartirish uchun <span class="kbd">Speed</span> tugmasini bosing.</p>
        </div>
        <div>
          <h3 style="margin:0;font-size:14px">Texnik ma'lumot</h3>
          <p>Yagona fayl: HTML + CSS + vanilla JS. Osonlik bilan React/Next.js ga o'tkazish mumkin.</p>
        </div>
        <div style="margin-top:auto">
          <button id="exportBtn">Export score (CSV)</button>
        </div>
      </aside>
    </div>
  </div>

<script>
// Simple Snake game (vanilla JS) — readable and easy to customize
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const speedBtn = document.getElementById('speedBtn');
  const exportBtn = document.getElementById('exportBtn');

  const upBtn = document.getElementById('upBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const downBtn = document.getElementById('downBtn');

  const gridSize = 20; // size of a tile in px
  const cols = Math.floor(canvas.width / gridSize);
  const rows = Math.floor(canvas.height / gridSize);

  let snake, dir, food, score, speed, loopId, running;
  const speeds = [100, 90, 75, 60, 45];
  let speedIndex = 2; // Normal

  function reset() {
    snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
    dir = {x:1,y:0};
    placeFood();
    score = 0; updateScore();
    running = false;
    clearLoop();
    updateHigh();
  }

  function start() {
    if (running) return;
    running = true;
    clearLoop();
    loopId = setInterval(tick, speeds[speedIndex]);
  }
  function pause() { running = false; clearLoop(); }
  function clearLoop(){ if(loopId) { clearInterval(loopId); loopId=null } }

  function placeFood(){
    let valid=false; let x,y;
    while(!valid){
      x = Math.floor(Math.random()*cols);
      y = Math.floor(Math.random()*rows);
      valid = !snake.some(s => s.x===x && s.y===y);
    }
    food = {x,y};
  }

  function tick(){
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    // wrap-around? let's make walls fatal for challenge
    if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows) { gameOver(); return }
    // self collision
    if (snake.some(s => s.x===head.x && s.y===head.y)) { gameOver(); return }

    snake.unshift(head);
    if (head.x===food.x && head.y===food.y) { score += 1; placeFood(); updateScore(); }
    else snake.pop();
    draw();
  }

  function gameOver(){
    pause();
    alert('Game over! Score: ' + score);
    saveHigh(score);
    updateHigh();
  }

  function draw(){
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // grid (subtle)
    ctx.save();
    ctx.globalAlpha=0.04;
    for(let i=0;i<cols;i++){
      ctx.fillRect(i*gridSize,0,1,canvas.height);
    }
    for(let j=0;j<rows;j++){
      ctx.fillRect(0,j*gridSize,canvas.width,1);
    }
    ctx.restore();

    // draw food
    ctx.fillStyle = '#06b6d4';
    ctx.fillRect(food.x*gridSize+2, food.y*gridSize+2, gridSize-4, gridSize-4);

    // draw snake
    for(let i=0;i<snake.length;i++){
      const s = snake[i];
      const v = i===0 ? 0.95 : 0.8;
      ctx.fillStyle = `rgba(124,58,237,${v})`;
      ctx.fillRect(s.x*gridSize+1, s.y*gridSize+1, gridSize-2, gridSize-2);
    }
  }

  function updateScore(){ scoreEl.textContent = score }

  // high score: localStorage
  function saveHigh(sc){
    const prev = parseInt(localStorage.getItem('snake_high')||'0',10);
    if (sc > prev) localStorage.setItem('snake_high', String(sc));
  }
  function updateHigh(){ highEl.textContent = localStorage.getItem('snake_high')||'0' }

  // controls
  window.addEventListener('keydown', (e) => {
    const k = e.key.toLowerCase();
    if (['arrowup','w'].includes(e.key.toLowerCase()) || k==='w') setDir(0,-1);
    if (['arrowdown','s'].includes(e.key.toLowerCase()) || k==='s') setDir(0,1);
    if (['arrowleft','a'].includes(e.key.toLowerCase()) || k==='a') setDir(-1,0);
    if (['arrowright','d'].includes(e.key.toLowerCase()) || k==='d') setDir(1,0);
  });

  function setDir(x,y){
    // prevent reversing
    if (snake.length>1 && snake[0].x + x === snake[1].x && snake[0].y + y === snake[1].y) return;
    dir = {x,y};
  }

  // touch buttons
  upBtn?.addEventListener('click', ()=> setDir(0,-1));
  leftBtn?.addEventListener('click', ()=> setDir(-1,0));
  rightBtn?.addEventListener('click', ()=> setDir(1,0));
  downBtn?.addEventListener('click', ()=> setDir(0,1));

  startBtn.addEventListener('click', ()=> start());
  pauseBtn.addEventListener('click', ()=> { if(running) pause(); else start(); });
  resetBtn.addEventListener('click', ()=> { reset(); draw(); });
  speedBtn.addEventListener('click', ()=> { speedIndex = (speedIndex+1) % speeds.length; speedBtn.textContent = 'Speed: ' + ['Very Slow','Slow','Normal','Fast','Very Fast'][speedIndex]; if(running){ start() } });

  exportBtn.addEventListener('click', ()=> {
    const csv = 'date,score\n' + new Date().toISOString() + ',' + score + '\n';
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'snake_score.csv'; a.click(); URL.revokeObjectURL(url);
  });

  // init
  reset(); draw(); updateHigh();

  // responsive canvas scaling for crispness
  function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    const displayWidth = canvas.clientWidth || canvas.width;
    const displayHeight = canvas.clientHeight || canvas.height;
    canvas.width = Math.floor(displayWidth * ratio);
    canvas.height = Math.floor(displayHeight * ratio);
    canvas.style.width = displayWidth + 'px';
    canvas.style.height = displayHeight + 'px';
    ctx.setTransform(ratio,0,0,ratio,0,0);
    // recompute cols/rows? we keep tile size constant so it's fine
    draw();
  }
  window.addEventListener('resize', () => resizeCanvas());
  // initial scale
  // keep canvas CSS size fixed and let drawing use pixel size
  canvas.style.width = '640px';
  canvas.style.height = '400px';
  resizeCanvas();
})();
</script>
</body>
</html>
